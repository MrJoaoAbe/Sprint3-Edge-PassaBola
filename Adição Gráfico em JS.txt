<section>
  <div id="grafico">
    <h1>Monitorar Batimentos Cardiacos</h1>

    <canvas id="chartBPM" width="600" height="300"></canvas>

    <div>
      <p>Batimentos: <span id="BPM">--</span> por Minuto</p>
      <p>Data e Hora: <span id="timestamp">--</span></p>
    </div>
  </div>
</section>

<!-- Importando o Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // Configuração inicial do gráfico
  const ctx = document.getElementById('chartBPM').getContext('2d');
  const chartBPM = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [], // timestamps
      datasets: [{
        label: 'Batimentos por Minuto (BPM)',
        data: [], // valores BPM
        borderColor: 'red',
        backgroundColor: 'rgba(255, 99, 132, 0.2)',
        borderWidth: 2,
        tension: 0.2 // curva mais suave
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: {
          title: { display: true, text: 'Tempo' }
        },
        y: {
          beginAtZero: true,
          title: { display: true, text: 'BPM' }
        }
      }
    }
  });

  // Função para buscar os dados
  function atualizarDados() {
    fetch('http://localhost:1880/dados') 
      .then(response => response.json())
      .then(data => {
        console.log("JSON recebido:", data);

        // Atualiza os elementos no HTML
        document.getElementById('BPM').textContent = data.BPM;
        document.getElementById('timestamp').textContent = data.timestamp;

        // Adiciona novos dados ao gráfico
        chartBPM.data.labels.push(data.timestamp); 
        chartBPM.data.datasets[0].data.push(data.BPM);

        // Mantém apenas os últimos 20 pontos (evitar gráfico infinito)
        if (chartBPM.data.labels.length > 20) {
          chartBPM.data.labels.shift();
          chartBPM.data.datasets[0].data.shift();
        }

        chartBPM.update();
      })
      .catch(e => {
        console.log("Falha ao buscar dados:", e);
      });
  }

  // Atualiza a cada 5 segundos
  setInterval(atualizarDados, 5000);

  // Chamada inicial
  atualizarDados();
</script>